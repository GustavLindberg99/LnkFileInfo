# Overview
The LnkFileInfo class is a class that parses LNK files and shows information about them, such as their target path, their icon, etc. Although LNK files are Windows-specific, this library is cross-platform, which means that it can also be used on non-Windows systems to parse LNK files that have been copied there from Windows.

# Setup
This class requires C++17 or later to work, there are no dependencies to third-party libraries. You can then use this library by downloading [lnkfileinfo.hpp](https://raw.githubusercontent.com/GustavLindberg99/LnkFileInfo/main/lnkfileinfo.hpp) and putting it in the same folder as your source code. This library is header only, so to use it, you just have to do `#include "lnkfileinfo.hpp"`.

# Usage
## Constructors of the `LnkFileInfo` class
1. `explicit LnkFileInfo(std::string file)`

    Constructs a new LnkFileInfo object that gives information about the given LNK file. `file` can be an absolute or a relative path.

    Exceptions:
    - `LnkFileInfo::IoError` if opening the file failed.
    - `LnkFileInfo::InvalidLnkFile` if the file is not a valid LNK file. Does *not* throw if the LNK file is valid but the target doesn't exist, use `std::filesystem::exists(lnkFileInfo.absoluteTargetPath())` to check for that.

2. `LnkFileInfo(const LnkFileInfo&)`

    Copy constructor, autogenerated by the compiler. Copies the information directly from the old object, does not read any new information from the file system.

3. `LnkFileInfo(LnkFileInfo&&) noexcept`

    Move constructor, autogenerated by the compiler. Moves the information directly from the old object, does not read any new information from the file system. It is safe to destroy or assign to a moved-from object, but not to call any methods on it.

## Overloaded operators of the `LnkFileInfo` class

- `bool operator==(const LnkFileInfo &other) const noexcept`

  Returns `true` if this LnkFileInfo object refers to the same LNK file as `other`, and `false` otherwise.

- `bool operator!=(const LnkFileInfo &other) const noexcept`

  Returns `false` if this LnkFileInfo object refers to the same LNK file as `other`, and `true` otherwise.

- `LnkFileInfo& operator=(const LnkFileInfo&)`

    Copy assignment operator, autogenerated by the compiler. Copies the information directly from the old object, does not read any new information from the file system.

- `LnkFileInfo& operator=(LnkFileInfo&&)`

    Move assignment operator, autogenerated by the compiler. Moves the information directly from the old object, does not read any new information from the file system. It is safe to destroy or assign to a moved-from object, but not to call any methods on it.

## Methods of the `LnkFileInfo` class
Information returned by methods is only read on construction or when calling `refresh()`, and is then cached in the LnkFileInfo object. Unless specified otherwise, methods then return the cached information.

All `std::string`s in this library use UTF-8.

- `std::string absoluteFilePath() const`

  Returns the absolute path of the LNK file itself, including the file name.

- `std::string absoluteTargetPath() const`

  Returns the absolute path of the target file. If the LNK file points to a nonexistent file, returns the absolute path of that nonexistent file.

- `std::string commandLineArgs() const`

  Returns the command line arguments of the LNK file, if any, not including the target. For example, if the LNK file points to `cmd.exe /v /c python.exe`, this method will return `/v /c python.exe`.

- `std::string description() const`

  Returns the description of the LNK file. The description is the custom text that appears when hovering over the LNK file in Windows Explorer, and can be edited in Windows Explorer by going to Properties -> Comment. If the LNK file has no custom description, this method returns an empty string.

- `std::string filePath() const`

  Returns the path of the LNK file itself as specified in the constructor, including the file name. Can be absolute or relative.

- `bool hasCustomIcon() const noexcept`

  Returns `true` if the LNK file has a custom icon (including if the icon was manually set to be the same as its target), and `false` if it doesn't (meaning the icon shown in Windows Explorer is the same as the target's icon). See also `iconPath()` and `iconIndex()`.

- `std::string iconPath() const`

  If the LNK file has a custom icon, returns the path to the file containing that icon. Returns an empty string if the LNK file has no custom icon. See also `hasCustomIcon()` and `iconIndex()`.

- `int iconIndex() const noexcept`

  If the LNK file has a custom icon, returns the index of that icon in the icon file. Returns zero if the LNK file has no custom icon. See also `hasCustomIcon()` and `iconPath()`.

- `void refresh()`

  Re-reads all the information about the LNK file from the file system.

  Exceptions:
  - `LnkFileInfo::IoError` if opening the file failed.
  - `LnkFileInfo::InvalidLnkFile` if the file is not a valid LNK file.

- `std::string relativeTargetPath() const`

  Returns the the path of the target relative to the LNK file, as specified in the LNK file. This can be useful for example if the LNK file and the target are both on a removeable drive for which the drive letter has changed, or if a common parent folder to the target and the LNK file has been moved or renamed. If this information is not present in the LNK file, returns an empty string.

  This method only reads the information present in the LNK file, so the information might not be up to date.

- `bool targetHasAttribute(Attribute attribute) const noexcept`

  Returns true if the target has the attribute `attribute`, and false otherwise. The attribute is of type [`LnkFileInfo::Attribute`](https://github.com/GustavLindberg99/LnkFileInfo#lnkfileinfoattribute-enum).

  This method only reads the information present in the LNK file, so the information might not be up to date.

- `bool targetIsOnNetwork() const noexcept`

  Returns `true` if the target is on a network drive, and `false` otherwise.

- `unsigned int targetSize() const noexcept`

  Returns the size of the target file in bytes. This method only reads the information present in the LNK file, so the information might not be up to date. For up to date information, you can use [`std::filesystem::file_size`](https://en.cppreference.com/w/cpp/filesystem/file_size).

- `int targetVolumeSerial() const noexcept`

  Returns the serial number of the volume that the target is on. Returns zero if target is on a network drive.

- `VolumeType targetVolumeType() const noexcept`

  Returns the type of volume the target is on as a [`LnkFileInfo::VolumeType`](https://github.com/GustavLindberg99/LnkFileInfo#lnkfileinfovolumetype-enum).

- `std::string targetVolumeName() const`

  Returns the name of the drive the target is on as shown in the This PC folder if that drive has a custom name, and an empty string otherwise. Note that on most Windows computers, while the hard drive is called "Local Disk" by default, this is not a custom name so an empty string will be returnd in that case.

- `std::string workingDirectory() const`

  Returns the working directory specified in the LNK file. This can be edited in Windows Explorer by going to Properties -> Start in.

## `LnkFileInfo::Attribute` enum
This enum is used together with the `targetHasAttribute` method to check if the target has a given attribute according to the LNK file, and contains the following values:

- `ReadOnly = 0x0001`
- `Hidden = 0x0002`
- `System = 0x0004`
- `VolumeLabel = 0x0008`
- `Directory = 0x0010`
- `Archive = 0x0020`
- `NtfsEfs = 0x0040`
- `Normal = 0x0080`
- `Temporary = 0x0100`
- `Sparse = 0x0200`
- `ReparsePointData = 0x0400`
- `Compressed = 0x0800`
- `Offline = 0x1000`

For more information about what each of these attributes mean, see [File attribute - Wikipedia](https://en.wikipedia.org/wiki/File_attribute).

## `LnkFileInfo::VolumeType` enum
This enum is used together with the `targetVolumeType` method to indicate which type of volume the target is on, and contains the following values:

- `Unknown = 0`
- `NoRootDirectory = 1`
- `Removable = 2`
- `HardDrive = 3`
- `NetworkDrive = 4`
- `CdRom = 5`
- `RamDrive = 6`

## Exception hierarchy
This library defines the following exception hierarchy. Standard library exception types that they inherit from are included for completeness.

- `std::exception`
  - `std::runtime_error`
    - `std::system_error`
      - `std::filesystem::filesystem_error`
        - `LnkFileInfo::Exception`: Base class of any exception that is thrown from this library.
          - `LnkFileInfo::IoError`: Exception that is thrown if reading a file failed.
          - `LnkFileInfo::InvalidLnkFile`: Exception that is thrown if an LNK file is invalid.

Methods that can throw these exception types are explicitly documented as such. Methods not explicitly documented as throwing do not normally throw any exceptions, but can in theory throw `std::bad_alloc` in case of memory exhaustion unless marked `noexcept`.

# Example code
Here is some example code that parses the Word.lnk shortcut on your desktop (if you have one). Note that the exact results may vary from one computer to another. Don't forget to change `myname` to your Windows user name.

```c++
#include <iostream>
#include "lnkfileinfo.hpp"

int main(){
    //Don't forget to make sure this file exists on your computer
    LnkFileInfo wordLnk("C:/Users/myname/Desktop/Word.lnk");

    std::cout << "Absolute target path: " << wordLnk.absoluteTargetPath() << std::endl;    // C:\Program Files\Microsoft Office\root\Office16\WINWORD.EXE
    std::cout << "Relative target path: " << wordLnk.relativeTargetPath() << std::endl;    // ..\..\..\..\..\Program Files\Microsoft Office\root\Office16\WINWORD.EXE
    std::cout << "Description: " << wordLnk.description() << std::endl;    // Create beautiful documents, easily work with others, and enjoy the read.
    std::cout << "Icon path: " << wordLnk.iconPath() << std::endl;    // C:\Program Files\Microsoft Office\Root\VFS\Windows\Installer\{90160000-000F-0000-1000-0000000FF1CE}\wordicon.exe
    std::cout << "Icon index: " << wordLnk.iconIndex() << std::endl;    // 0, meaning the icon of the LNK file is the first icon in the the wordicon.exe file
    std::cout << "Target size: " << wordLnk.targetSize() << std::endl;    // 1637680, which is the size the WINWORD.EXE file in bytes at the time the LNK file was created

    return 0;
}
```
